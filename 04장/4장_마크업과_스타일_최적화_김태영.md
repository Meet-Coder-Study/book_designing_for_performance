# 4장 마크업과 스타일 최적화

사이트에는 이미지 뿐만 아니라 HTML, CSS, JavaScript 등도 페이지 로딩 시간에 영향을 미치게 된다.
<br>따라서 작업자가 어떻게 구조를 잡고 마크업의 이름을 짓느냐에 따라 사이트의 지속적인 유지보수와 높은 성능을 유지할 수 있다.

HTML과 CSS를 간결하고 의미있게 만드는 것이 곧 사이트의 빠른 로딩과 전반적으로 더 나은 사용자 경험으로 나타난다.

## 1. HTML 청소하기

마크업과 스타일 청소만으로도 페이지 로딩 시간은 반으로 줄 수 있다.

- 스타일시트로 옮길 필요가 있는 내장 스타일이나 코드 사이에 포함된 스타일
- 특별한 스타일 적용이 필요하지 않은 요소 (흔히 디비티스라고 하는 불필요한 HTML 요소)
- 오래되고 주석으로 처리되어 제거할 수 있는 코드

책에서 이야기 하는 대로 복잡한 마크업을 보관해야 하는 “만약”은 없으니 불필요한 태그와 스타일은 모두 정리하고 GitHub과 같은 형상 관리 도구를 활용해 코드 버전 관리를 하는 습관을 들여놓으면 좋겠다.

### 디비티스

디비티스(divitis)는 사소한 이유로 HTML 내에 과하게 많은 요소가 사용된 상태를 말한다.

단순히 스타일링과 구분을 위해 불필요하게 태그를 추가하지 말고 HTML5의 header, article과 같은 시멘틱 마크업을 적절히 활용 하는 것이 코드가 비대해지지 않고 문맥 기반의 구조를 작성할 수 있으며 간결해진 구조 만큼 CSS를 어떻게 작성할지 더 쉽게 알 수 있고 동시에 재사용 가능한 디자인 패턴을 만들 기회도 얻을 수 있다.

**주의하면 좋은 실수**

```html
<header>
	<h2>heading</h2>
</header>
```

HTML5의 시멘틱 마크업을 사용해 문맥을 유지 시키려고 무분별하게 `<header>`, `<footer>` 태그를 사용하면 오히려 디비티스와 같은 효과를 낳을 수 있으니 굳이 `<header>`태그가 필요하지 않을 땐 생략해도 좋겠다.

```html
<h2>heading</h2>
```


### 문맥 기반

책에서는 문맥 기반을 유지하기 위해 다음 내용을 언급하고 있다.

- 의미에 맞는 class명을 부여
- 단순 구분이 아닌, 문맥에 맞는 태그 사용

이렇게 문맥을 유지하면,

- class명이 중복되 스타일이 덮어씌워지는 가능성을 줄일 수 있음
- HTML과 CSS를 읽기 쉬워져 유지보수가 하기 쉬워짐
- 파일 크기가 작아져 페이지 로딩 시간을 줄이는 효과를 볼 수 있음
- 무엇을 위한 코드인지 명확히 알 수 있기 때문에 디자인 스타일을 재사용 할 수 있게됨

이러한 더 나은 사용자 경험을 얻을 수 있다.

### 접근성

간결한 HTML 문맥은 마크업 성능과 편집의 용이함 뿐만 아니라 사이트 접근성에도 도움을 준다.

HTML5 시멘틱 마크업을 사용 하는 것으로 스크린 리더가 이해하기 좋은 콘텐츠를 제공하면 사용자에게 더 의미있는 HTML 콘텐츠를 제공할 수 있다.

### 프레임워크와 그리드

사이트를 손쉽게 만들기 위해 이미 만들어진 기능과 디자인을 가져와 활용하는 프레임워크는 사용하기 전에 나에게 필요한 기능만 가져다 쓸 수 있게 커스텀 해서 사용하는게 좋다.

**개인적 의견**
<br>특히 테마를 구입해서 사용하는 경우 어마어마한 기능과 애니메이션이 들어있어 굉장히 무거우니 주의해야한다…
<br>가능하다면 프레임워크는 가져다 쓰지 않는 것이 좋을 것 같다.

## 2. CSS 정리하기

사이트 레이아웃을 잡을 땐 다방면으로 생각한 후 HTML 계층을 만들어야 한다.
또 신중히 선택 해야 유지보수 하기 좋은 CSS를 작성할 수 있게 된다.

이미 작성된 기존 CSS를 정리하려면 다음 항목을 체크하길 권장한다

- 문맥상 의미가 없는 요소 이름
- !important 선언
- 특정 브라우저에만 적용되는 기능
- 과도하게 사용된 셀렉터 특이성

개선할 수 있는 스타일은 개선하고 크로스브라우징을 위해 추가했던 오래된 코드는 찾아서 정리하자.

코드는 여러 사람의 손을 거치기 때문에 항상 유지보수 용이성과 사이트의 성능 유지를 위해 잘 정리해 두어야 한다.

### 사용하지 않는 스타일

서비스가 종료된 페이지의 스타일이나, 이름이 변경되어 적용되지 않는 스타일 등은 정리 하는 것으로 사용자가 굳이 다운받을 필요 없게 해야한다.

### 스타일 합치고 줄이기

스타일이 비슷하여 공통으로 적용되는 스타일이 있는 요소가 있다면, 공통 스타일을 합치는 것으로 코드를 줄일 수 있다.

또한 CSS 축약을 사용해서 불필요하게 분해되어 나열된 스타일을 한 줄로 줄여서 사용하는 것으로 코드 가독성과 유지보수성도 높일 수 있다.

```css
/* 축약 전 */
background-color: red;
background-image: url('');
background-repeat: no-repeat;
background-size: cover;
background-position: top right;

/* 축약 후 */
background: red url('') no-repeat top right / cover;
```

### 스타일 시트 이미지 정리하기

스타일 시트 내 이미지도 최적화를 해줘야한다.

1. **낱개 이미지 스프라이트 이미지로 변경**
작은 아이콘이나 사이트 전반에 자주 사용되는 이미지가 있다면 스프라이트 이미지를 고려하자.
2. **스프라이트 이미지 업데이트**
오래 된 사이트일수록 스프라이트 이미지도 오래되어 있을 것이다.
사용되지 않는 이미지가 포함되진 않았는지 검토하고 제거할 것은 제거해야한다.
3. **대체할 수 있는 이미지 검토**
CSS로 대체할 수 있는 그라디언트나 SVG로 대체하는 것으로 일반 해상도와 고해상도를 동시에 대응하는것도 좋다.

Q. 스타일 시트 이미지를 SVG로 대체하는데 어디서 긍정적인 영향을 주는지 잘 모르겠다.
<br>해상도에 대해서만 이점이 있나?

### 특이성 제거하기

불필요하게 가중치가 들어간 셀렉터는 줄이고 별도의 class를 추가하여 스타일을 적용하는게 좋으며,
<br>특이성이 많이 들어가게 된다면 HTML의 구조가 잘못되지 않았나 다시 확인 해보는게 좋다.

또한 !important의 사용은 **반드시** 지양해야한다. (없는 속성이라 생각하자)
<br>important는 또 다시 important를 불러 무한 important 지옥에 빠질 수 있다…

## 3. 웹 글꼴 최적화

### 대체 글꼴

폰트를 선언할 때 알아두면 좋은 것으로

```css
body {
	font-family: '메인 폰트', '대체 폰트', sans-serif;
}
```

메인 폰트에서 지원하지 않는 외형의 글자의 경우 대체 폰트를 불러온다.

다국어 사이트를 지원하거나 영문 폰트, 한글 폰트를 각각 지정하고 싶다면

```css
body {
	font-family: '영문 폰트', '한글 폰트', sans-serif;
}
```

이렇게 한글을 지원하지 않는 “영문 폰트”를 먼저 선언 하는 것으로 뒤의 “한글 폰트”가 적용되게 할 수 있다.

이 외의 내용은 폰트를 생성할 때 최적화 하는 방법과 구글 fonts의 사용법을 안내하기 때문에 넘어간다.

## 4. 재사용 할 수 있는 마크업 만들기

재사용 할 수 있는 디자인 패턴이 있으면 개발 시간과 페이지 로딩 시간을 절약할 수 있다.

또한 마크업을 재사용 할 수 있다면 다음과 같은 효과를 얻을 수 있다.

- 자원을 캐싱할 수 있는 기회 제공
- 디자이너나 개발자가 이미 있는 것을 또 만드는 일 방지
- 새로운 콘텐츠가 추가될 때 불필요한 자원 요청 제거
- 더 이상 필요하지 않은 스타일과 자원분리

재사용 할 수 있는 마크업을 만들기 위해선 스타일 가이드를 작성하는게 좋다.

### 스타일 가이드

문서화가 잘 된 스타일 가이드가 있다면 사이트를 만드는데 가이드를 제공하여 불필요한 추가 작업을 줄일 수 있고 나중에 다른 사람이 작업 할 때 모범 사례를 제공하여 나중에 합류한 디자이너와 개발자가 진입장벽 없게 올바른 사이트를 구성할 수 있게 된다.

스타일 가이드가 가장 잘 된 예로 “[부트스트랩](https://getbootstrap.com/)”을 들 수 있을 것 같다.

## 5. 마크업에 대한 추가 고려사항

마크업과 스타일을 정리 한 후에도 페이지 로딩을 위해  자원 로딩 순서 변경, 최소화, 캐싱 등 추가 작업이 필요하다.

### CSS와 자바스크립트 로딩

CSS와 자바스크립트 로딩에는 두 가지 규칙이 있다.

- `<head>`에서 CSS 호출
- 페이지 하단에서 자바스크립트 로딩

#### CSS

스타일시트가 페이지 렌더링을 방해하지 않게 하기위해 head에서 호출하여 브라우저가 더 이상 스타일을 찾지 않게하고

또한 스타일시트의 파일 개수를 가능한 적게 유지하는 것으로 브라우저의 요청 횟수도 줄여 페이지 로딩 속도를 높일 수 있다.

그리고 페이지 로딩 속도를 위해 `@import`의 사용을 지양해야하는데, import는 페이지 로딩 속도를 늘릴 뿐만 아니라 잘못 사용하면 내가 원하는 로드 방식을 만들지 못하게 된다.

예로 전 회사에서, sitestyle.css에 사이트 스타일링을 하고 css link를 줄이기 위해 sitestyle.css 에 normalize.css를 import가 되어있었는데,
<br>사이트 스타일 이후에 normalize 스타일이 적용되어 기껏 작성한 스타일이 노멀라이즈에 의해 야무지게 초기화 되는 슬픔을 겪었던 경험이 있다..

다음과 같이 sitestyle.css에 normalize.css를 import 하고 body에 글꼴을 적용한 다음

```css
@import 'normalize.css';

body {
	font-family: 'Noto Sans KR', sans-serif;
}
```

normalize.css에서 body의 폰트를 선언하면

```css
body {
	font-family: serif;
}
```

sitestyle.css가 먼저 호출 완료 된 후 normalize.css가 호출되기 때문에 body에는 serif체가 적용된다…

또한 CSS의 파일 용량은 적을 수록 좋기 때문에, 공통으로 적용되는 스타일(레이아웃 등)을 담은 CSS파일을 캐싱해두고 페이지별로 스타일시트 파일을 생성해 호출하면 브라우저 요청 횟수도 줄이고 스타일시트 파일 경량화로 빠르게 호출되게 할 수 있다.


#### 자바스크립트

자바스크립트 파일은 페이지 끝에서 **가능한 비동기** 방식으로 로딩 되어야 한다.

브라우저는 자바스크립트를 만나면 DOM 만들기를 일시 중단하고 스크립트를 처리하기 때문에 비동기 방식으로 호출하는 것으로 사용자의 체감 성능을 개선하고 렌더링 블로킹 문제를 해결할 수 있다.

물론 비동기로 호출할 땐 비동기 스크립트가 페이지에 어떤 영향을 미치는지 살펴봐야하며 비동기 속성은 로딩 순서를 보장하지 않기 때문에 의존성 문제를 일으킬 수 있다는 점을 주의해야한다.

또한 서드파티 서버에서 스크립트를 받는다면 페이지 크기에 많은 부담을 줄 수 있고 내부 자원이 아니기 때문에 추가적인 DNS 조회가 필요하게 되어 성능 문제도 발생할 수 있고 캐싱 또한 제어할 수 없다.

그러니 가능한 타사 스크립트는 제거하도록 노력하고 스크립트를 복제하여 내부 코드에 맞게 최적화 하거나 대응할 수 있는 방법이 있다면 타사 스크립트는 사용하지 않는 것도 최적화에 도움이 될 것이다.

마지막으로 개발자도구의 폭포수 차트를 통해 다른 파일 로드가 끝나고 마지막으로 자바스크립트 파일을 받는지,
자바스크립트 파일이 다른 파일의 다운로드나 화면의 중요한 부분을 그리는 것을 방해하지 않는지 확인하자.


### 최소화와 Gzip

서버쪽 설정이라 굳이 정리하지 않았습니다.

### 자원 캐싱하기

서버쪽 설정이라 굳이 정리하지 않았습니다.
